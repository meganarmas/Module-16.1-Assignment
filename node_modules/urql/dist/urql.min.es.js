import{createRequest as e}from"@urql/core";export*from"@urql/core";import*as t from"react";import{toPromise as r,take as n,filter as u,onPush as a,subscribe as o,takeWhile as i,onEnd as c}from"wonka";var s=t.createContext({}),f=s.Provider,l=s.Consumer;s.displayName="UrqlContext";var v=()=>t.useContext(s),d={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},p=(e,t)=>e===t||!(!e||!t||e.key!==t.key),x=(e,t)=>{var r={...e,...t,data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale};return((e,t)=>{for(var r in e)if(!(r in t))return!0;for(var n in t)if("operation"===n?!p(e[n],t[n]):e[n]!==t[n])return!0;return!1})(e,r)?r:e},y=(e,t)=>{for(var r=0,n=t.length;r<n;r++)if(e[r]!==t[r])return!0;return!1};function h(e,t){e(t)}function g(o){var i=t.useRef(!0),c=v(),[s,f]=t.useState(d),l=t.useCallback(((t,s)=>(h(f,{...d,fetching:!0}),r(n(1)(u((e=>!e.hasNext))(a((e=>{i.current&&h(f,{fetching:!1,stale:e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation})}))(c.executeMutation(e(o,t),s||{}))))))),[c,o,f]);return t.useEffect((()=>(i.current=!0,()=>{i.current=!1})),[]),[s,l]}function k(r,n){var u=t.useRef(void 0);return t.useMemo((()=>{var t=e(r,n);return void 0!==u.current&&u.current.key===t.key?u.current:(u.current=t,t)}),[r,n])}var b=e=>{if(!e._react){var t=new Set,r=new Map;e.operations$&&o((e=>{"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),r.delete(e.key))}))(e.operations$),e._react={get:e=>r.get(e),set(e,n){t.delete(e),r.set(e,n)},dispose(e){t.add(e)}}}return e._react},m=(e,t)=>t&&void 0!==t.suspense?!!t.suspense:e.suspense;function q(e){var r=v(),n=b(r),u=m(r,e.context),s=k(e.query,e.variables),f=t.useMemo((()=>{if(e.pause)return null;var t=r.executeQuery(s,{requestPolicy:e.requestPolicy,...e.context});return u?a((e=>{n.set(s.key,e)}))(t):t}),[n,r,s,u,e.pause,e.requestPolicy,e.context]),l=t.useCallback(((e,t)=>{if(!e)return{fetching:!1};var r=n.get(s.key);if(r){if(t&&null!=r&&"then"in r)throw r}else{var u,a=o((e=>{r=e,u&&u(r)}))(i((()=>t&&!u||!r))(e));if(null==r&&t){var c=new Promise((e=>{u=e}));throw n.set(s.key,c),c}a.unsubscribe()}return r||{fetching:!0}}),[n,s]),p=[r,s,e.requestPolicy,e.context,e.pause],[g,q]=t.useState((()=>[f,x(d,l(f,u)),p])),P=g[1];f!==g[0]&&y(g[2],p)&&q([f,P=x(g[1],l(f,u)),p]),t.useEffect((()=>{var e=g[0],t=g[2][1],r=!1,u=e=>{r=!0,h(q,(t=>{var r=x(t[1],e);return t[1]!==r?[t[0],r,t[2]]:t}))};if(e){var a=o(u)(c((()=>{u({fetching:!1})}))(e));return r||u({fetching:!0}),()=>{n.dispose(t.key),a.unsubscribe()}}u({fetching:!1})}),[n,g[0],g[2][1]]);var C=t.useCallback((t=>{var o={requestPolicy:e.requestPolicy,...e.context,...t};h(q,(e=>[u?a((e=>{n.set(s.key,e)}))(r.executeQuery(s,o)):r.executeQuery(s,o),e[1],p]))}),[r,n,s,u,e.requestPolicy,e.context,e.pause]);return[P,C]}function P(e,r){var n=v(),u=k(e.query,e.variables),a=t.useRef(r);a.current=r;var i=t.useMemo((()=>e.pause?null:n.executeSubscription(u,e.context)),[n,u,e.pause,e.context]),s=[n,u,e.context,e.pause],[f,l]=t.useState((()=>[i,{...d,fetching:!!i},s])),p=f[1];i!==f[0]&&y(f[2],s)&&l([i,p=x(f[1],{fetching:!!i}),s]),t.useEffect((()=>{var e=e=>{h(l,(t=>{var r=x(t[1],e);return t[1]===r?t:(a.current&&null!=r.data&&t[1].data!==r.data&&(r.data=a.current(t[1].data,r.data)),[t[0],r,t[2]])}))};if(f[0])return o(e)(c((()=>{e({fetching:!!i})}))(f[0])).unsubscribe;e({fetching:!1})}),[f[0]]);var g=t.useCallback((t=>{var r=n.executeSubscription(u,{...e.context,...t});h(l,(e=>[r,e[1],s]))}),[n,u,e.context,e.pause]);return[p,g]}function C(e){var t=g(e.query);return e.children({...t[0],executeMutation:t[1]})}function w(e){var t=q(e);return e.children({...t[0],executeQuery:t[1]})}function S(e){var t=P(e,e.handler);return e.children({...t[0],executeSubscription:t[1]})}export{l as Consumer,s as Context,C as Mutation,f as Provider,w as Query,S as Subscription,v as useClient,g as useMutation,q as useQuery,P as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
